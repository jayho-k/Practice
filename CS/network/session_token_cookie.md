# 세션,토큰, 쿠키

요약

- 쿠키 : 그냥 옮겨주는 애(수화물)
- 토큰 : 서버가 기억하는 이상하게 생긴 텍스트 => 사인 (여권에 도장 찍는 느낌)
- JWP : 정보를 갖고 있는 토큰. DB없이 검증 가능
- 세션 : 휘발성 ID 가지고 있는애 ==> 정보저장은 서버에서





## 쿠키

- 서버는 쿠키를 이용해서 사용자의 브라우저에 데이터를 넣을 수 있음(정보를 기억하기 위해)



1. 사이트 방문
2. 브라우저는 서버에 요청을 보냄
3. 서버 응답 => 모든 데이터, 페이지 정보를 보내줌 => 이때 쿠키도 같이 보내줌
   (브라우저에 저장하고자 하는)
4. 브라우저에 쿠키를 저장한 후 해당 웹사이트에 방문 할때마다 브라우저는 해당 쿠키도 요청과 함께 보내짐 (즉 나의 브라우저에 관한 정보가 저장되었다는 뜻)

- 특징
  - 도메인에 따라 제한됨
  - 유효기간 전제
  - 인증 외 여러가지 정보 저장 가능(언어설정 변경 등)



## 세션

- stateless
  - 서버로가는 모든 요청이 이전 요청과 독립적으로 다뤄진다는 뜻
  - request끼리 연결없음
  - 메모리 없음
  - 즉 요청이 끝나면 서버에서는 저장안함 ==> 누군지 잃어버림
  - 따라서 요청을 보낼때마다 정보를 줘야함 (내가 누구인지)



- ssession이 이것을 사용함



쿠키와 세션의 관계

1. 아이디 비번 침 => 서버에 보내짐
2. 세션 DB에 유저를 생성함 (세션은 요청이 끝나면 저장 안함)(일시적)
3. 세션에는 별도의 ID가 있음
4. 이 ID를 쿠키를 통해서 브라우저로 다시 보냄 => 그리고 저장
5. 다른 웹페이지로 이동 ==> 다시 쿠키 서버에 보냄(세션 ID와 함께) (즉 페이지 변경되어도 로그인 유지)
6. 서버는 쿠키를 확인
7. 세션ID 발견
8. 서버는세션ID 세션 DB로 보냄
9. 세션DB가 세션 ID를 확인
10. 거기에 유저네임이 있다는 것을 확인
11. 이때 서버가 누군지 알게 됨
12. 다른 페이지로 넘어가는면 다시 반복



- 즉 서버가 모든 정보를 가지고 있음
- 세션은 단지 세션ID만가지고 있음



- 안드로이드나 ios에서는 쿠키를 사용할 수 없음
- 이떄 토큰을 보냄



##  JWP

- 유저가 늘어남에 따라 DB 리소스가 더 필요함
- 그래서 생겨남



- 특징

  - 토큰 형식(정보를 토큰에 저장함)

  - 세션 DB필요 없음

  - 서버는 유저 인증한다고 많은 일을 할 필요 없음

  - 이상하게 생긴 텍스트임
  - 서버에 request할때마다 보내야함
  - 제약이 없어서 엄청 길어도 상관없음



- JWP와 세션의 차이점
  1. 서버에 정보 보냄(아이디 비번)
  2. 정보가 맞아도 DB에서 무언가를 생성하지 않음
  3. 서버는 유저의 ID를 이용해서 사인을 함
  4. 그 사인된 정보를 string형태로 이상한 문자를 보내게 됨(그냥 정보에 싸인 하고 전달하는게 끝)
  5. 이제 서버에 요청보내기
  6. 사인된 정보 혹은 토큰을 서버에 보내야함
  7. 서버는 토크을 받으면 해당 사인이 유효한지 확인(조작등등 확인)
  8. 확인 됐으면 유저로 인증





## 세션과 JWT의 장단점

- 세션

  - 장점
    - 로그인 된 유저의 모든 정보를 저장
    - 해당정보를 이용해 새로운 기능 추가 가능
      - 유저 강퇴, 원하지 않는 디바이스에서 강제 로그아웃 가능, 공유 숫자등등
    - 서버가 현재 누가 그것이 이용하는지 다 알 수 있는건 세션 덕분임

  - 단점
    - 비용



- JWP ex) 코로나 QR코드 
  - 장점
    - 비용
  - 단점
    - 강퇴 등등을 할 수 없음
    - 유효기간이 있기 때문



























